@using Microsoft.AspNetCore.Http
@using TravelAgency.Models

@{
    Layout = "_HomeLayout";
    ViewData["Title"] = "TRAVEL AGENCY";

    var totalTrips = (int)(ViewBag.TotalTrips ?? 0);

    var popularTrips = ViewBag.PopularTrips as List<Trip> ?? new List<Trip>();
    var featuredTrips = ViewBag.FeaturedTrips as List<Trip> ?? new List<Trip>();
    var galleryImages = ViewBag.GalleryImages as List<string> ?? new List<string>();
    var siteReviews = ViewBag.SiteReviews as IEnumerable<dynamic> ?? new List<dynamic>();

    var role = Context.Session.GetString("Role");

    string Img(string? path)
    {
        if (string.IsNullOrWhiteSpace(path)) return Url.Content("~/tourly/assets/images/placeholder.jpg");
        // אם אתה שומר ב-DB נתיב כמו "/uploads/xxx.jpg" או "uploads/xxx.jpg"
        if (path.StartsWith("http", StringComparison.OrdinalIgnoreCase)) return path;
        if (path.StartsWith("~/")) return Url.Content(path);
        if (path.StartsWith("/")) return path;
        return "/" + path.TrimStart('/');
    }

    string TripTitle(Trip t)
    {
        if (!string.IsNullOrWhiteSpace(t.PackageName)) return t.PackageName!;
        return $"{t.Destination} {t.Category}".Trim();
    }

    bool IsOnSale(Trip t)
        => t.OldPrice != null && t.DiscountEndDate != null && t.DiscountEndDate > DateTime.Now;
}

<header class="header" data-header>

    <div class="overlay" data-overlay></div>

    <div class="header-top">
        <div class="container">

            <a href="#" class="helpline-box">
                <div class="icon-box">
                    <ion-icon name="call-outline"></ion-icon>
                </div>

                <div class="wrapper">
                    <p class="helpline-title">For Further Inquires :</p>
                    <p class="helpline-number">TRAVEL AGENCY Support</p>
                </div>
            </a>

            <a href="/Home/Index" class="logo">
                @* Logo removed *@
            </a>

            <div class="header-btn-group">
                @* Removed non-functional search button to reduce clutter *@

                <button class="nav-open-btn" aria-label="Open Menu" data-nav-open-btn>
                    <ion-icon name="menu-outline"></ion-icon>
                </button>
            </div>

        </div>
    </div>

    <div class="header-bottom">
        <div class="container">

            <ul class="social-list">
                @* Social links removed *@
            </ul>

            <nav class="navbar" data-navbar>

                <div class="navbar-top">
                    <a href="/Home/Index" class="logo">
                        @* Logo removed *@
                    </a>

                    <button class="nav-close-btn" aria-label="Close Menu" data-nav-close-btn>
                        <ion-icon name="close-outline"></ion-icon>
                    </button>
                </div>

                <ul class="navbar-list">
                    <li><a href="#home" class="navbar-link" data-nav-link>home</a></li>
                    <li><a href="#destination" class="navbar-link" data-nav-link>destination</a></li>
                    <li><a href="#gallery" class="navbar-link" data-nav-link>gallery</a></li>
                    <li><a href="/Trips/Gallery" class="navbar-link" data-nav-link>trips</a></li>
                    <li><a href="#reviews" class="navbar-link" data-nav-link>reviews</a></li>

                    @if (Context.Session.GetInt32("UserId") != null)
                    {
                        <li><a href="/Booking/MyBookings" class="navbar-link" data-nav-link>my bookings</a></li>
                        <li><a href="/Account/Profile" class="navbar-link" data-nav-link>profile</a></li>

                        if (role == "Admin")
                        {
                            <li><a href="/Admin/Trips" class="navbar-link" data-nav-link>admin</a></li>
                        }

                        <li><a href="/Account/Logout" class="navbar-link" data-nav-link>logout</a></li>
                    }
                    else
                    {
                        <li><a href="/Account/Login" class="navbar-link" data-nav-link>login</a></li>
                        <li><a href="/Account/Register" class="navbar-link" data-nav-link>register</a></li>
                    }
                </ul>

            </nav>

            @if (role == "Admin")
            {
                <a class="btn btn-primary" href="/Admin">Admin Dashboard</a>
            }
            else
            {
                <a class="btn btn-primary" href="/Trips/Gallery">Book Now</a>
            }

        </div>
    </div>

</header>

<main>
    <article>

        <!-- HERO -->
        <section class="hero" id="home">
            <div class="container">

                <h2 class="h1 hero-title">TRAVEL AGENCY</h2>

                <p class="hero-text">
                    Discover amazing destinations, book your trip, pay securely, and download your itinerary as PDF.
                    <br />
                    <b>@totalTrips</b> trips available right now.
                </p>

                <div class="btn-group">
                    <a class="btn btn-primary" href="/Trips/Gallery">Explore Trips</a>

                    @if (role == "Admin")
                    {
                        <a class="btn btn-secondary" href="/Admin">Admin Dashboard</a>
                    }
                    else
                    {
                        <a class="btn btn-secondary" href="#destination">Learn more</a>
                    }
                </div>

            </div>
        </section>

        <!-- TOUR SEARCH (מחובר לגלריה שלך) -->
        <section class="tour-search">
            <div class="container">

                <form action="/Trips/Gallery" method="get" class="tour-search-form">

                    <div class="input-wrapper">
                        <label for="search" class="input-label">Search Destination*</label>
                        <input type="text" name="search" id="search" placeholder="Enter Destination" class="input-field" />
                    </div>

                    <button type="submit" class="btn btn-secondary">Search</button>

                </form>

            </div>
        </section>

        <!-- POPULAR (דינאמי מה-DB) -->
        <section class="popular" id="destination">
            <div class="container">

                <p class="section-subtitle">Uncover place</p>
                <h2 class="h2 section-title">Popular destination</h2>

                <p class="section-text">
                    Explore our most popular destinations — choose your perfect package and start your journey.
                </p>

                <ul class="popular-list">
                    @foreach (var t in popularTrips.Take(3))
                    {
                        <li>
                            <div class="popular-card">
                                <figure class="card-img">
                                    <img src="@Img(t.ImagePath)" alt="@t.Destination, @t.Country" loading="lazy" />
                                </figure>

                                <div class="card-content">
                                    <div class="card-rating">
                                        <ion-icon name="star"></ion-icon>
                                        <ion-icon name="star"></ion-icon>
                                        <ion-icon name="star"></ion-icon>
                                        <ion-icon name="star"></ion-icon>
                                        <ion-icon name="star"></ion-icon>
                                    </div>

                                    <p class="card-subtitle"><a href="/Trips/Gallery?search=@t.Country">@t.Country</a></p>
                                    <h3 class="h3 card-title"><a href="/Trips/Details/@t.TripId">@t.Destination</a></h3>
                                    <p class="card-text">@TripTitle(t)</p>
                                </div>
                            </div>
                        </li>
                    }
                </ul>

                <a class="btn btn-primary" href="/Trips/Gallery">More destination</a>

            </div>
        </section>

        <!-- PACKAGE (דינאמי מה-DB) -->
       

        <!-- SITE REVIEWS (דינאמי מה-DB) -->
        <section class="popular" id="reviews">
            <div class="container">

                <p class="section-subtitle">Testimonials</p>
                <h2 class="h2 section-title">What our users say</h2>

                <p class="section-text">
                    Latest reviews from our users (SiteReviews).
                </p>

                <ul class="popular-list">
                    @foreach (var r in siteReviews.Take(3))
                    {
                        int rating = (int)r.Rating;
                        <li>
                            <div class="popular-card">
                          

                                <div class="card-content">
                                    <div class="card-rating">
                                        @for (int i = 0; i < 5; i++)
                                        {
                                            <ion-icon name="star"></ion-icon>
                                        }
                                    </div>

                                    <p class="card-subtitle">
                                        <a href="#">@r.FullName</a>
                                    </p>

                                    <h3 class="h3 card-title">
                                        <a href="#">@rating / 5</a>
                                    </h3>

                                    <p class="card-text">
                                        @(!string.IsNullOrWhiteSpace((string)r.Comment) ? (string)r.Comment : "No comment provided.")
                                    </p>
                                </div>
                            </div>
                        </li>
                    }
                </ul>


            </div>
        </section>

        <!-- GALLERY (דינאמי מה-DB) -->
        <section class="gallery" id="gallery">
            <div class="container">

                <p class="section-subtitle">Photo Gallery</p>
                <h2 class="h2 section-title">Photo's From Travellers</h2>

                <p class="section-text">
                    A glimpse of unforgettable moments from our community.
                </p>

                <ul class="gallery-list">
                    @foreach (var img in galleryImages.Take(5))
                    {
                        <li class="gallery-item">
                            <figure class="gallery-image">
                                <img src="@Img(img)" alt="Gallery image" />
                            </figure>
                        </li>
                    }
                </ul>

            </div>
        </section>

        <!-- CTA -->
        <section class="cta" id="contact">
            <div class="container">
                <div class="cta-content">
                    <p class="section-subtitle">Call To Action</p>
                    <h2 class="h2 section-title">Ready For Unforgettable Travel?</h2>
                    <p class="section-text">
                        Join TRAVEL AGENCY today — browse trips, book, and get reminders before departure.
                    </p>
                </div>

                <a class="btn btn-secondary" href="/Trips/Gallery">Explore Trips</a>
            </div>
        </section>

    </article>
</main>

<footer class="footer">
    <div class="footer-top">
        <div class="container">

            <div class="footer-brand">
                

                <p class="footer-text">
                    TRAVEL AGENCY — book trips, pay securely, join waiting lists, receive email notifications,
                    and download itinerary PDF.
                </p>
            </div>

            <div class="footer-contact">
                <h4 class="contact-title">Contact Us</h4>
                <p class="contact-text">Feel free to contact and reach us !!</p>

                <ul>
                    <li class="contact-item">
                        <ion-icon name="call-outline"></ion-icon>
                        <a href="#" class="contact-link">Support Center</a>
                    </li>

                    <li class="contact-item">
                        <ion-icon name="mail-outline"></ion-icon>
                        <a href="mailto:travelagency23454@gmail.com" class="contact-link">travelagency23454@gmail.com</a>
                    </li>

                    <li class="contact-item">
                        <ion-icon name="location-outline"></ion-icon>
                        <address>TRAVEL AGENCY Office</address>
                    </li>
                </ul>
            </div>

            <div class="footer-form">
                <p class="form-text">Subscribe our newsletter for more update & news !!</p>

                <form action="#" class="form-wrapper">
                    <input type="email" name="email" class="input-field" placeholder="Enter Your Email" required />
                    <button type="submit" class="btn btn-secondary">Subscribe</button>
                </form>
            </div>

        </div>
    </div>

    <div class="footer-bottom">
        <div class="container">
            <p class="copyright">
                &copy; @DateTime.Now.Year TRAVEL AGENCY. All rights reserved.
            </p>

            <ul class="footer-bottom-list">
                <li><a href="/Home/Privacy" class="footer-bottom-link">Privacy Policy</a></li>
                <li><a href="#" class="footer-bottom-link">Term & Condition</a></li>
                <li><a href="#" class="footer-bottom-link">FAQ</a></li>
            </ul>
        </div>
    </div>
</footer>

<a href="#top" class="go-top" data-go-top>
    <ion-icon name="chevron-up-outline"></ion-icon>
</a>
